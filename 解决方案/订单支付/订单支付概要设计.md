一、正向流程：

1. 订单创建-生成订单，根据优惠规则计算商品金额
1. 订单超时-超过半小时未支付，订单关闭
1. 订单支付-支付流水号、支付时间
1. 第三方支付、余额支付、余额充值
1. 开通云服务，提供算力主机信息
1. 订单完成-监控云服务器状态

二、逆向流程：

7. 订单取消-未支付订单关闭
7. 订单取消-已支付未开通订单关闭、退款
7. 订单取消-已支付已开通订单关闭、退款、关闭云服务

待实现功能：

1. 订单防重-加入dedup_key实现下单接口的create-or-get
1. 周期性自动扣款
1. 资金退回方式（仅支持12个月内的资金按原支付账户返回）
1. 花呗分期支付

对接的支付方式：

1. JSAPI支付：商家张贴收款码物料，用户打开扫一扫，扫码后输入金额，完成付款；开发文档
1. Native支付：商家在系统中按微信支付协议生成支付二维码，用户扫码拉起微信收银台，确认并完成付款。开发文档
1. 回调通知触发条件：交易创建、支付成功、交易完成、支付成功（触发通知）

五、订单超时未支付关闭订单：
	定时任务每隔30秒启动一次，找出最近10分钟内创建并且未支付的订单，调用《微信支付查单接口》核实订单状态。系统记录订单查询的次数，在10次查询之后状态还是未支付成功，则停止后续查询，并调用《关单接口》关闭订单。（轮询时间间隔和次数，商户可以根据自身业务场景灵活设置）

六、支付流程
![订单支付 (1).png](https://cdn.nlark.com/yuque/0/2022/png/120775/1650457701757-87e67720-63d9-476c-84f2-90e837a14c6e.png#clientId=udae97342-e006-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=713&id=u0ddcbf15&margin=%5Bobject%20Object%5D&name=%E8%AE%A2%E5%8D%95%E6%94%AF%E4%BB%98%20%281%29.png&originHeight=713&originWidth=1122&originalType=binary&ratio=1&rotation=0&showTitle=false&size=120146&status=done&style=none&taskId=u533855cc-e184-4fc1-ae8e-8b68d382e50&title=&width=1122)
