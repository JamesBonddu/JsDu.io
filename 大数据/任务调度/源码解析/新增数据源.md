# 新增DM数据源参考

https://github.com/apache/dolphinscheduler/pull/12860/files#diff-8e7f3e5f1a031e6cd7b4e85b15573c81e815d30b8b027b9af1ff3800435d343c

# 新增online数据源

```sh
curl 'http://127.0.0.1:5173/dolphinscheduler/datasources' \
  -H 'Accept: application/json, text/plain, */*' \
  -H 'Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7' \
  -H 'Cache-Control: no-cache' \
  -H 'Connection: keep-alive' \
  -H 'Content-Type: application/json;charset=UTF-8' \
  -H 'Cookie: securityConfigType=PASSWORD; sessionId=40ebb781-4926-4dd9-af83-f25226a9cdc2; language=zh_CN; sessionId=40ebb781-4926-4dd9-af83-f25226a9cdc2' \
  -H 'Origin: http://127.0.0.1:5173' \
  -H 'Pragma: no-cache' \
  -H 'Referer: http://127.0.0.1:5173/datasource' \
  -H 'Sec-Fetch-Dest: empty' \
  -H 'Sec-Fetch-Mode: cors' \
  -H 'Sec-Fetch-Site: same-origin' \
  -H 'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36' \
  -H 'language: zh_CN' \
  -H 'sec-ch-ua: "Google Chrome";v="107", "Chromium";v="107", "Not=A?Brand";v="24"' \
  -H 'sec-ch-ua-mobile: ?0' \
  -H 'sec-ch-ua-platform: "Windows"' \
  -H 'sessionId: 40ebb781-4926-4dd9-af83-f25226a9cdc2' \
  --data-raw '{"type":"MYSQL","label":"MYSQL","name":"cdh06-online","note":"cdh06-online","host":"47.103.78.125","port":3306,"principal":"","javaSecurityKrb5Conf":"","loginUserKeytabUsername":"","loginUserKeytabPath":"","userName":"root","password":"TuringExchangis@666","database":"ds","connectType":"","other":{"useSSL":"false"},"testFlag":0,"bindTestId":1}' \
  --compressed
```

# 新增datax转换任务节点

```sh
curl 'http://127.0.0.1:5173/dolphinscheduler/projects/7551150189056/process-definition' \
  -H 'Accept: application/json, text/plain, */*' \
  -H 'Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7' \
  -H 'Cache-Control: no-cache' \
  -H 'Connection: keep-alive' \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  -H 'Cookie: securityConfigType=PASSWORD; sessionId=40ebb781-4926-4dd9-af83-f25226a9cdc2; language=zh_CN; sessionId=40ebb781-4926-4dd9-af83-f25226a9cdc2' \
  -H 'Origin: http://127.0.0.1:5173' \
  -H 'Pragma: no-cache' \
  -H 'Referer: http://127.0.0.1:5173/projects/7551150189056/workflow/definitions/create' \
  -H 'Sec-Fetch-Dest: empty' \
  -H 'Sec-Fetch-Mode: cors' \
  -H 'Sec-Fetch-Site: same-origin' \
  -H 'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36' \
  -H 'language: zh_CN' \
  -H 'sec-ch-ua: "Google Chrome";v="107", "Chromium";v="107", "Not=A?Brand";v="24"' \
  -H 'sec-ch-ua-mobile: ?0' \
  -H 'sec-ch-ua-platform: "Windows"' \
  -H 'sessionId: 40ebb781-4926-4dd9-af83-f25226a9cdc2' \
  --data-raw 'taskDefinitionJson=%5B%7B%22code%22%3A7558742791680%2C%22delayTime%22%3A%220%22%2C%22description%22%3A%22data-test%22%2C%22environmentCode%22%3A-1%2C%22failRetryInterval%22%3A%221%22%2C%22failRetryTimes%22%3A%220%22%2C%22flag%22%3A%22YES%22%2C%22name%22%3A%22data-test%22%2C%22taskParams%22%3A%7B%22localParams%22%3A%5B%5D%2C%22resourceList%22%3A%5B%5D%2C%22customConfig%22%3A0%2C%22dsType%22%3A%22MYSQL%22%2C%22dataSource%22%3A2%2C%22dtType%22%3A%22MYSQL%22%2C%22dataTarget%22%3A2%2C%22sql%22%3A%22select%20park_name%2C%20carrier_category%2C%20name%2C%20area%20from%20%20%60carrier%60%22%2C%22targetTable%22%3A%22target_carrier%22%2C%22jobSpeedByte%22%3A0%2C%22jobSpeedRecord%22%3A1000%2C%22preStatements%22%3A%5B%22truncate%20table%20target_carrier%22%5D%2C%22postStatements%22%3A%5B%5D%2C%22xms%22%3A1%2C%22xmx%22%3A1%7D%2C%22taskPriority%22%3A%22MEDIUM%22%2C%22taskType%22%3A%22DATAX%22%2C%22timeout%22%3A0%2C%22timeoutFlag%22%3A%22CLOSE%22%2C%22timeoutNotifyStrategy%22%3A%22%22%2C%22workerGroup%22%3A%22default%22%2C%22cpuQuota%22%3A-1%2C%22memoryMax%22%3A-1%2C%22taskExecuteType%22%3A%22BATCH%22%7D%5D&taskRelationJson=%5B%7B%22name%22%3A%22%22%2C%22preTaskCode%22%3A0%2C%22preTaskVersion%22%3A0%2C%22postTaskCode%22%3A7558742791680%2C%22postTaskVersion%22%3A0%2C%22conditionType%22%3A%22NONE%22%2C%22conditionParams%22%3A%7B%7D%7D%5D&locations=%5B%7B%22taskCode%22%3A7558742791680%2C%22x%22%3A263%2C%22y%22%3A268%7D%5D&name=datax-test&tenantCode=default&executionType=PARALLEL&description=datax-test&globalParams=%5B%5D&timeout=0' \
  --compressed
```

# 插件注册

org.apache.dolphinscheduler.service.task.TaskPluginManager:[59] - Registering task plugin: JAVA

# 权限控制

```java
// src/main/java/org/apache/dolphinscheduler/api/service/impl/BaseServiceImpl.java
@Override
public boolean canOperatorPermissions(User user, Object[] ids,AuthorizationType type,String permissionKey) {
    boolean operationPermissionCheck = resourcePermissionCheckService.operationPermissionCheck(type, type.equals(AuthorizationType.PROJECTS) ? ids : null, user.getId(), permissionKey, logger);
    boolean resourcePermissionCheck = resourcePermissionCheckService.resourcePermissionCheck(type, ids, user.getUserType().equals(UserType.ADMIN_USER) ? 0 : user.getId(), logger);
    return operationPermissionCheck && resourcePermissionCheck;
}
```
