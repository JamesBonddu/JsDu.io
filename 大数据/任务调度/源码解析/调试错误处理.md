# 错误处理

```sh
2018-03-20 23:34:01,887 [myid:99] - INFO  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181:NIOServerCnxnFactory@197] - Accepted socket connection from /10.121.82.229:33749
2018-03-20 23:34:01,887 [myid:99] - WARN  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181:ZooKeeperServer@793] - Connection request from old client /10.121.82.229:33749; will be dropped if server is in r-o mode
2018-03-20 23:34:01,887 [myid:99] - INFO  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181:ZooKeeperServer@839] - Client attempting to establish new session at /10.121.82.229:33749
2018-03-20 23:34:01,890 [myid:99] - INFO  [CommitProcessor:99:ZooKeeperServer@595] - Established session 0x6362257b44e5068d with negotiated timeout 10000 for client /10.121.82.229:33749
2018-03-20 23:34:21,859 [myid:99] - WARN  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181:NIOServerCnxn@349] - caught end of stream exception
EndOfStreamException: Unable to read additional data from client sessionid 0x6362257b44e5068d, likely client has closed socket
        at org.apache.zookeeper.server.NIOServerCnxn.doIO(NIOServerCnxn.java:220)
        at org.apache.zookeeper.server.NIOServerCnxnFactory.run(NIOServerCnxnFactory.java:208)
        at java.lang.Thread.run(Thread.java:745)
2018-03-20 23:34:21,860 [myid:99] - INFO  [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181:NIOServerCnxn@1001] - Closed socket connection for client /10.121.82.229:33749 which had sessionid 0x6362257b44e5068d
```

https://www.cnblogs.com/zhangmingcheng/p/12073818.html

https://github.com/apache/dubbo/issues/346


datax 任务处理
```sh
[LOG-PATH]: D:\project\turing\dolphinscheduler\logs\20221116\7568519730304_1-12-2.log, [HOST]:  Host{address='172.28.48.1:1234', ip='172.28.48.1', port=1234}
[INFO] 2022-11-16 08:46:28.283 +0800 - Begin to pulling task
[INFO] 2022-11-16 08:46:28.284 +0800 - Begin to initialize task
[INFO] 2022-11-16 08:46:28.285 +0800 - Set task startTime: Wed Nov 16 08:46:28 CST 2022
[INFO] 2022-11-16 08:46:28.286 +0800 - Set task envFile: /etc/profile
[INFO] 2022-11-16 08:46:28.286 +0800 - Set task appId: 12_2
[INFO] 2022-11-16 08:46:28.286 +0800 - End initialize task
[INFO] 2022-11-16 08:46:28.287 +0800 - Set task status to TaskExecutionStatus{code=1, desc='running'}
[INFO] 2022-11-16 08:46:28.364 +0800 - TenantCode:JSDu check success
[INFO] 2022-11-16 08:46:28.365 +0800 - ProcessExecDir:/tmp/dolphinscheduler/exec/process/JSDu/7562259384832/7568519730304_1/12/2 check success
[INFO] 2022-11-16 08:46:28.366 +0800 - Resources:{} check success
[INFO] 2022-11-16 08:46:28.366 +0800 - Task plugin: DATAX create success
[INFO] 2022-11-16 08:46:28.366 +0800 - datax task params {"localParams":[],"resourceList":[],"customConfig":0,"dsType":"MYSQL","dataSource":1,"dtType":"MYSQL","dataTarget":1,"sql":"select park_name, carrier_category,name, area from carrier","targetTable":"target_carrier","jobSpeedByte":0,"jobSpeedRecord":1000,"preStatements":["truncate table target_carrier"],"postStatements":[],"xms":1,"xmx":1}
[INFO] 2022-11-16 08:46:28.366 +0800 - Success initialized task plugin instance success
[INFO] 2022-11-16 08:46:28.366 +0800 - Success set taskVarPool: null
[INFO] 2022-11-16 08:46:28.368 +0800 - Begin to create command file:/tmp/dolphinscheduler/exec/process/JSDu/7562259384832/7568519730304_1/12/2/12_2.bat
[INFO] 2022-11-16 08:46:28.369 +0800 - Success create command file, command: @echo off
cd /d %~dp0
call /etc/profile
/tmp/dolphinscheduler/exec/process/JSDu/7562259384832/7568519730304_1/12/2/12_2_node.bat
[ERROR] 2022-11-16 08:46:28.376 +0800 - datax task error
java.io.IOException: Cannot run program "sudo" (in directory "\tmp\dolphinscheduler\exec\process\JSDu\7562259384832\7568519730304_1\12\2"): CreateProcess error=2, 系统找不到指定的文件。
	at java.lang.ProcessBuilder.start(ProcessBuilder.java:1048)
	at org.apache.dolphinscheduler.plugin.task.api.AbstractCommandExecutor.buildProcess(AbstractCommandExecutor.java:143)
	at org.apache.dolphinscheduler.plugin.task.api.AbstractCommandExecutor.run(AbstractCommandExecutor.java:199)
	at org.apache.dolphinscheduler.plugin.task.datax.DataxTask.handle(DataxTask.java:161)
	at org.apache.dolphinscheduler.server.worker.runner.DefaultWorkerDelayTaskExecuteRunnable.executeTask(DefaultWorkerDelayTaskExecuteRunnable.java:49)
	at org.apache.dolphinscheduler.server.worker.runner.WorkerTaskExecuteRunnable.run(WorkerTaskExecuteRunnable.java:174)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:131)
	at com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:74)
	at com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:82)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.io.IOException: CreateProcess error=2, 系统找不到指定的文件。
	at java.lang.ProcessImpl.create(Native Method)
	at java.lang.ProcessImpl.<init>(ProcessImpl.java:444)
	at java.lang.ProcessImpl.start(ProcessImpl.java:140)
	at java.lang.ProcessBuilder.start(ProcessBuilder.java:1029)
	... 12 common frames omitted
[ERROR] 2022-11-16 08:46:28.376 +0800 - Task execute failed, due to meet an exception
org.apache.dolphinscheduler.plugin.task.api.TaskException: Execute DataX task failed
	at org.apache.dolphinscheduler.plugin.task.datax.DataxTask.handle(DataxTask.java:173)
	at org.apache.dolphinscheduler.server.worker.runner.DefaultWorkerDelayTaskExecuteRunnable.executeTask(DefaultWorkerDelayTaskExecuteRunnable.java:49)
	at org.apache.dolphinscheduler.server.worker.runner.WorkerTaskExecuteRunnable.run(WorkerTaskExecuteRunnable.java:174)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:131)
	at com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:74)
	at com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:82)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.io.IOException: Cannot run program "sudo" (in directory "\tmp\dolphinscheduler\exec\process\JSDu\7562259384832\7568519730304_1\12\2"): CreateProcess error=2, 系统找不到指定的文件。
	at java.lang.ProcessBuilder.start(ProcessBuilder.java:1048)
	at org.apache.dolphinscheduler.plugin.task.api.AbstractCommandExecutor.buildProcess(AbstractCommandExecutor.java:143)
	at org.apache.dolphinscheduler.plugin.task.api.AbstractCommandExecutor.run(AbstractCommandExecutor.java:199)
	at org.apache.dolphinscheduler.plugin.task.datax.DataxTask.handle(DataxTask.java:161)
	... 9 common frames omitted
Caused by: java.io.IOException: CreateProcess error=2, 系统找不到指定的文件。
	at java.lang.ProcessImpl.create(Native Method)
	at java.lang.ProcessImpl.<init>(ProcessImpl.java:444)
	at java.lang.ProcessImpl.start(ProcessImpl.java:140)
	at java.lang.ProcessBuilder.start(ProcessBuilder.java:1029)
	... 12 common frames omitted
[INFO] 2022-11-16 08:46:28.385 +0800 - Get a exception when execute the task, will send the task execute result to master, the current task execute result is TaskExecutionStatus{code=6, desc='failure'}
```

先暂时做个替换走linux
```sh
# user data local directory path, please make sure the directory exists and have read write permissions
#data.basedir.path=/tmp/dolphinscheduler
data.basedir.path=D:/ds-data/dolphinscheduler

# resource view suffixs
#resource.view.suffixs=txt,log,sh,bat,conf,cfg,py,java,sql,xml,hql,properties,json,yml,yaml,ini,js

# resource storage type: HDFS, S3, OSS, NONE
resource.storage.type=NONE
# resource store on HDFS/S3 path, resource file will store to this base path, self configuration, please make sure the directory exists on hdfs and have read write permissions. "/dolphinscheduler" is recommended
#resource.storage.upload.base.path=/dolphinscheduler
resource.storage.upload.base.path=D:/ds-data/data
```

```sh
choco install gsudo

command.add("sudo");
command.add("-u");
command.add(taskRequest.getTenantCode());
command.add("-E");
```

开启调试模式

src/main/resources/common.properties

```sh
# development state
development.state=true
```

https://stackoverflow.com/questions/9652720/how-to-run-sudo-command-in-windows


pid找不到

https://stackoverflow.com/questions/4750470/how-to-get-pid-of-process-ive-just-started-within-java-program

```sh
export HADOOP_HOME=${HADOOP_HOME:-/opt/soft/hadoop}
export HADOOP_CONF_DIR=${HADOOP_CONF_DIR:-/opt/soft/hadoop/etc/hadoop}
export SPARK_HOME1=${SPARK_HOME1:-/opt/soft/spark1}
export SPARK_HOME2=${SPARK_HOME2:-/opt/soft/spark2}
export PYTHON_HOME=${PYTHON_HOME:-/opt/soft/python}
export HIVE_HOME=${HIVE_HOME:-/opt/soft/hive}
export FLINK_HOME=${FLINK_HOME:-/opt/soft/flink}
export DATAX_HOME=${DATAX_HOME:-/opt/soft/datax}

export PATH=$HADOOP_HOME/bin:$SPARK_HOME1/bin:$SPARK_HOME2/bin:$PYTHON_HOME/bin:$JAVA_HOME/bin:$HIVE_HOME/bin:$FLINK_HOME/bin:$DATAX_HOME/bin:$PATH
```
